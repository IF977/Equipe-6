<div class="row">
    <section class="col-md-8">
        <h1><%= @e.name %></h1>
        <div class="wig-tag">mpb</div>
        <div class="wig-tag">comida brasileira</div>
        <div class="wig-tag">ambiente familiar</div>
        <p class="wig-description">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc imperdiet, lacus et suscipit laoreet, est ipsum commodo risus, elementum commodo ex lectus sit amet nibh. Maecenas nec enim ullamcorper, rhoncus lorem at, placerat ipsum. Etiam bibendum vitae massa nec gravida. Ut mauris nunc, auctor consequat faucibus at, tincidunt sit amet libero. Nam lobortis dui sed elit iaculis, at imperdiet ligula lacinia. Aliquam id orci eleifend ipsum porta sagittis eget eget nulla. Mauris ac ante elit. Ut sit amet elit sed justo varius mattis.</p>
        
        <div class="wig-establishment-map" id="map"></div>

        <h2>Comentários</h2>

        <% @comments.each do |c| %>
            <div class="wig-comment">
                <div class="row">
                    <div class="col-md-1">
                        <div class="wig-comment-userpic"></div>
                    </div>
                    <div class="col-md-11">
                        <h4><%= c[0] %></h4>
                        <p><%= c[1] %></p>
                    </div>
                </div>
            </div>
        <% end %>

        <%=form_for :establishment_comment, url: {action: 'user_comment_establishment'}, :method => :POST do |e| %>
            <div id="form-inputs">
                <%= e.text_area :comment, class: "wig-textbox", placeholder: "Digite aqui seu comentário" %>
            </div>
            <%= e.submit "Comentar", class: "wig-button" %>

        <% end %>
        <%= flash_message.html_safe %>        
    </section>
    <aside class="col-md-4">
        <div class="wig-establishment-pic">
            <%=image_tag(@e.image, class:"wig-establishment-pic")%>
        </div>
        <div class="wig-establishment-info">
            <ul>
                <li><div class="info-icon"><i class="fa fa-map-marker" aria-hidden="true"></i></div><%= @e.address %></li>
                <li><div class="info-icon"><i class="fa fa-phone" aria-hidden="true"></i></div>(81) 3498-3298</li>
                <li><div class="info-icon"><i class="fa fa-envelope-open" aria-hidden="true"></i></div><%= @e.email %></li>
                <li><div class="info-icon"><i class="fa fa-globe" aria-hidden="true"></i></div><%= @e.website %></li>
            </ul>
        </div>

        <div class="wig-review">
            <h3>Avalie este estabelecimento</h3>
            <div class="wig-review-box">
                <div class="wig-thumbs">
                    <a href="<%= url_for(controller: "dashboard_client", action: "user_review_establishment", review: true, id: @e.id) %>" id="review-true">
                        <div class="wig-review-thumb" >
                            <i class="fa fa-thumbs-up" aria-hidden="true"></i>
                        </div>
                    </a>
                    <a href="<%= url_for(controller: "dashboard_client", action: "user_review_establishment", review: false, id: @e.id) %>" id="review-false">
                        <div class="wig-review-thumb">
                            <i class="fa fa-thumbs-down" aria-hidden="true"></i>
                        </div>
                    </a>
                </div>
                
                <div class="wig-percentbar" data-toggle="tooltip" data-placement="bottom" title="">
                    <div id="positive"></div>
                    <div id="percent"><%= @rating_percentage %></div>
                </div>
            </div>
        </div>
    </aside>
</div>
<script>
    function setPercentBarWidth() {
        $("#positive").css("width", $("#percent").html());
    }
    function setExistingReview() {
        <% if @user_review_selected == true %>
            $("#review-true").addClass("wig-thumbs-active");
            console.log("true");
        <% end %>
        <% if @user_review_selected == false %>
            $("#review-false").addClass("wig-thumbs-active");
            console.log("false");
        <% end %>
    }
    $(document).ready(function() { 
        setPercentBarWidth();
        setExistingReview();
    });
    
    function initMap() {

        var geo = new google.maps.Geocoder();
        
        var map = new google.maps.Map(document.getElementById('map'), {
            center: { lat: -8.0624203, lng: -34.9270747 }, /* Recife */
            zoom: 15
        })
        
        geo.geocode( { 'address': '<%= @e.address %>' }, function(results, status) {
            if (status == 'OK') {
                map.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
            } else {
                console.log('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
    
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_VH_8voCP76YUOPKhmIsTaWwhN3rHK0M&libraries=places&callback=initMap" async defer></script>
    
</script>
